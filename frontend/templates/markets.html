{% extends "base.html" %}
{% block content %}
<section class="card">
  <h3>Market Search</h3>
  <div class="input-row">
    <input id="market-query" placeholder="Search Polymarket markets (e.g., bitcoin, election)" />
    <select id="market-category">
      <option value="">All Categories</option>
      <option value="crypto">Crypto</option>
      <option value="politics">Politics</option>
      <option value="sports">Sports</option>
      <option value="macro">Macro</option>
      <option value="other">Other</option>
    </select>
    <button onclick="window.ui.loadMarkets()" class="btn-primary">Search</button>
  </div>
  <div style="margin-top: 12px; font-size: 0.85rem; color: var(--muted);">
    Popular searches: <span onclick="document.getElementById('market-query').value='bitcoin'; window.ui.loadMarkets();" style="cursor: pointer; color: var(--accent);">bitcoin</span>, 
    <span onclick="document.getElementById('market-query').value='election'; window.ui.loadMarkets();" style="cursor: pointer; color: var(--accent);">election</span>, 
    <span onclick="document.getElementById('market-query').value='weather'; window.ui.loadMarkets();" style="cursor: pointer; color: var(--accent);">weather</span>
  </div>
  <table class="table" style="margin-top: 16px;">
    <thead>
      <tr>
        <th>Market ID</th>
        <th>Title</th>
        <th>Liquidity</th>
        <th>Volume 24h</th>
      </tr>
    </thead>
    <tbody id="market-results"></tbody>
  </table>
  <div id="market-results-empty" class="empty" style="display: none; margin-top: 12px;">No markets found. Try a different search term.</div>
</section>

<div id="position-modal" class="modal" style="display: none;">
  <div class="modal-content">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
      <h2>Make a Position</h2>
      <button type="button" onclick="window.ui.closePositionModal()" class="icon-button">Ã—</button>
    </div>
    <div class="muted" id="position-market-title" style="margin-bottom: 8px;">Market</div>
    <form id="position-form" onsubmit="window.ui.submitPosition(event)">
      <div class="form-grid">
        <div class="form-group">
          <label>Market ID</label>
          <input id="position-market-id" type="text" readonly />
        </div>
        <div class="form-group">
          <label>Outcome</label>
          <select id="position-outcome">
            <option value="yes">YES</option>
            <option value="no">NO</option>
          </select>
        </div>
        <div class="form-group">
          <label>Shares</label>
          <input id="position-quantity" type="number" min="1" value="1" />
        </div>
        <div class="form-group">
          <label>Limit Price</label>
          <input id="position-price" type="number" min="0.01" max="0.99" step="0.01" />
        </div>
      </div>
      <div class="muted" id="position-market-meta" style="margin: 8px 0;"></div>
      <div id="position-error" class="auth-error" style="display: none; margin-bottom: 8px;"></div>
      <div style="display: flex; gap: 8px; margin-top: 8px;">
        <button type="submit" class="btn-primary">Place Bet</button>
        <button type="button" onclick="window.ui.closePositionModal()" class="btn-secondary">Cancel</button>
      </div>
    </form>
  </div>
</div>

<style>
  input[type="text"] {
    width: 100%;
  }
  .market-row {
    cursor: pointer;
  }
  .market-row:hover {
    background: rgba(0, 0, 0, 0.04);
  }
  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
  }
  .icon-button {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
  }
</style>
{% endblock %}
{% block scripts %}
<script>
  // Allow search on Enter key
  document.getElementById('market-query').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') window.ui.loadMarkets();
  });
</script>
{% endblock %}
