{% extends "base.html" %}
{% block content %}
<section class="card">
  <h3>Workforce Chat Assistant</h3>
  <div class="muted" style="margin-bottom: 12px;">Ask the CAMEL workforce agent for market insights, trading strategies, or workforce status.</div>
  
  <div class="input-row" style="margin-bottom: 12px;">
    <input id="chat-context" placeholder="Context (e.g., polymarket, bitcoin-2024, election)" />
    <button onclick="window.ui.loadChatContext()" class="btn-secondary" style="white-space: nowrap;">Load Context</button>
  </div>
  
  <div class="chat-window" id="chat-window" style="min-height: 300px; margin-bottom: 12px;">
    <div class="chat-msg assistant" style="align-self: flex-start;">
      <div style="font-size: 12px; color: var(--muted); margin-bottom: 4px;">Assistant</div>
      <div>Hello! I'm the Polymarket workforce agent. Ask me about market conditions, trading strategies, or current positions.</div>
    </div>
  </div>
  
  <div class="input-row" style="gap: 8px;">
    <input id="chat-input" type="text" placeholder="Ask a question..." style="flex: 1;" />
    <button onclick="window.ui.sendChat()" class="btn-primary">Send</button>
  </div>
  
  <div style="margin-top: 8px; font-size: 11px; color: var(--muted);">
    ðŸ’¡ Tip: Use context tags like #bitcoin, #election to focus the conversation
  </div>
</section>

<style>
  #chat-window {
    display: flex;
    flex-direction: column;
    gap: 8px;
    overflow-y: auto;
    padding: 12px;
    background: #0d131b;
    border: 1px solid #1f2a3a;
    border-radius: 8px;
    max-height: 500px;
  }
  
  .chat-msg {
    padding: 10px 12px;
    border-radius: 8px;
    max-width: 80%;
    word-wrap: break-word;
  }
  
  .chat-msg.user {
    background: linear-gradient(135deg, #1b2836, #141f2a);
    align-self: flex-end;
    border: 1px solid rgba(89, 212, 198, 0.1);
    color: var(--text);
  }
  
  .chat-msg.assistant {
    background: linear-gradient(135deg, #13202b, #0d151b);
    align-self: flex-start;
    border: 1px solid #1f2a3a;
    color: var(--text);
  }
  
  #chat-input {
    flex: 1;
  }
</style>
{% endblock %}
{% block scripts %}
<script>
  // Initialize chat
  window.ui.sendChat = async () => {
    const input = document.getElementById('chat-input');
    const message = input.value.trim();
    if (!message) return;
    
    const chatWindow = document.getElementById('chat-window');
    
    // Add user message
    const userMsg = document.createElement('div');
    userMsg.className = 'chat-msg user';
    userMsg.innerHTML = `<div style="font-size: 12px; color: var(--muted); margin-bottom: 4px;">You</div><div>${message}</div>`;
    chatWindow.appendChild(userMsg);
    chatWindow.scrollTop = chatWindow.scrollHeight;
    
    input.value = '';
    
    // Simulate assistant response (in production, call actual API)
    setTimeout(() => {
      const assistantMsg = document.createElement('div');
      assistantMsg.className = 'chat-msg assistant';
      assistantMsg.innerHTML = `<div style="font-size: 12px; color: var(--muted); margin-bottom: 4px;">Assistant</div><div>I'm analyzing your query: "${message}". In production, this would connect to the CAMEL workforce agent for detailed market analysis and trading recommendations.</div>`;
      chatWindow.appendChild(assistantMsg);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }, 500);
  };
  
  window.ui.loadChatContext = () => {
    const context = document.getElementById('chat-context').value || 'general';
    alert(`Context set to: ${context}`);
  };
  
  // Allow sending on Enter
  document.getElementById('chat-input').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') window.ui.sendChat();
  });
</script>
{% endblock %}

